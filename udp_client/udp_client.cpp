#include <iostream>
#include <boost/array.hpp>
#include <boost/asio.hpp>
#include <string>
#include <boost/thread/thread.hpp>
#include "udp_client.hpp"

using boost::asio::ip::udp;

int main(int argc, char* argv[])
{
  try
  {
    boost::asio::io_service io_service;
    udp::socket socket(io_service, udp::endpoint(udp::v4(), 1813));

    std::string remoteIp("127.0.0.1");
    unsigned short remotePort = 30001;
    std::string localIp("127.0.0.1");
    unsigned short localPort = 50001;
 
    boost::asio::ip::udp::endpoint remote_endpoint(boost::asio::ip::address::from_string(remoteIp), remotePort);

    boost::array<char, 87> send_buf1 = { 0x04,0x67,0x00,0x57,0x40,0xb6,0x64,0xdb,0xf5,0xd6,0x81,0xb2,0xad,0xbd,0x17,0x69,
                                          0x51,0x51,0x18,0xc8,0x01,0x07,0x73,0x74,0x65,0x76,0x65,0x02,0x12,0xdb,0xc6,0xc4,
                                          0xb7,0x58,0xbe,0x14,0xf0,0x05,0xb3,0x87,0x7c,0x9e,0x2f,0xb6,0x01,0x04,0x06,0xc0,
                                          0xa8,0x00,0x1c,0x05,0x06,0x00,0x00,0x00,0x7b,0x50,0x12,0x5f,0x0f,0x86,0x47,0xe8,
                                          0xc8,0x9b,0xd8,0x81,0x36,0x42,0x68,0xfc,0xd0,0x45,0x32,0x4f,0x0c,0x02,0x66,0x00,
                                          0x0a,0x01,0x73,0x74,0x65,0x76,0x65 };

    boost::array<char, 131> send_buf2 = { 0x05,0x67,0x00,0x83,0x83,0xec,0xe7,0x07,0xa2,0xf3,0x1b,0xb6,0x5b,0xad,0xfb,0x22,
                                         0xa6,0x40,0x23,0xd9,0x06,0x06,0x00,0x00,0x00,0x02,0x07,0x06,0x00,0x00,0x00,0x01,
                                         0x08,0x06,0xac,0x10,0x03,0x21,0x09,0x06,0xff,0xff,0xff,0x00,0x0a,0x06,0x00,0x00,
                                         0x00,0x03,0x0b,0x09,0x73,0x74,0x64,0x2e,0x70,0x70,0x70,0x0c,0x06,0x00,0x00,0x05,
                                         0xdc,0x0d,0x06,0x00,0x00,0x00,0x01,0x4f,0x18,0x01,0x67,0x00,0x16,0x04,0x10,0xff,
                                         0x0b,0xf1,0xd6,0xe4,0x01,0xa9,0xcb,0xe5,0xb4,0x6e,0xb9,0x43,0xe5,0x54,0x9a,0x50,
                                         0x12,0x6e,0x79,0x4a,0x02,0x0c,0x45,0xc6,0x6f,0x42,0x47,0xba,0x8c,0x5f,0xf0,0x4e,
                                         0xd1,0x18,0x12,0x73,0x6f,0x86,0x85,0x73,0x08,0x82,0x77,0x41,0x4a,0xe3,0xf3,0x1e,
                                         0xac,0x34,0xe9 };

    socket.send_to(boost::asio::buffer(send_buf1), remote_endpoint);

    boost::this_thread::sleep( boost::posix_time::seconds(1) );

    socket.send_to(boost::asio::buffer(send_buf2), remote_endpoint);

    std::cout << "UDP client sent 2 packets " << std::endl;
  }
  catch (std::exception& e)
  {
    std::cerr << e.what() << std::endl;
  }

  return 0;
}

